# Inception


# Table of Contents
- [Docker](#docker)
    - [Docker Components](#docker-components)
        - [Image](#image)
        - [Container](#container)
        - [Volume](#volume)
        - [Network](#network)
    - [Dockerfile](#dockerfile)
    - [Docker Compose](#docker-compose)
- [Containers](#containers)
    - [NGINX](#nginx)
    - [WordPress + php-fpm](#wordpress-+-php-fpm)
    - [MariaDB](#mariadb)
- [Volumes](#volumes)
    - [Wordpress Database](#wordpress-database)
    - [WordPress Website](#wordpress-website)
- [Networks](#networks)
    - [Docket-network](#docker-network)

# Docker
Docker is a platform that enables developers to easily pack, ship, and run applications as lightweight, portable containers. 
These containers are isolated environments that contain everything needed to run the application, including the code, runtime, system tools, and libraries. 
Docker simplifies the deployment process by ensuring consistency across different environments, from development to production.

## Docker Components
### Image
An image in Docker is a lightweight, standalone, and executable software package that contains everything needed to run a piece of software, including the code, runtime, libraries, environment variables, and system tools. 
It serves as a blueprint for creating containers and can be built using a Dockerfile or pulled from a registry like Docker Hub.

```Makefile
creation:
    docker build            # Build an image from a Dockerfile.

deletion:
    docker rmi              # Remove one or more images.

information:
    docker images           # List images.
    docker inspect          # Display detailed information on one or more images.
    docker history          # Show the history of an image.

registry:
    docker login            # Log in to a Docker registry.
    docker logout           # Log out from a Docker registry.
    docker pull             # Pull an image or a repository from a registry.
    docker push             # Push an image or a repository to a registry.
```

### Container
A container is a runnable instance of an image. 
It encapsulates the application and its dependencies, running in isolation from other containers and the host system. 
Containers are lightweight, portable, and can be easily moved or replicated across different environments. 
They have their own filesystem, network, and process namespace, providing isolation and ensuring that they do not interfere with each other.

```Makefile
creation:
    docker run              # Run a command in a new container.
    docker create           # Create a new container but do not start it.
    docker start            # Start one or more stopped containers.

interaction:
    docker exec             # Run a command in a running container.
    docker attach           # Attach to a running container.
    docker pause            # Pause all processes within one or more containers.
    docker unpause          # Unpause all processes within one or more containers.
    docker cp               # Copy files/folders between a container and the local filesystem.

deletion:
    docker stop             # Stop one or more running containers.
    docker kill             # Kill one or more running containers.
    docker rm               # Remove one or more containers.
    docker prune            # Remove all stopped containers.

information:
    docker ps               # List containers.
    docker inspect          # Display detailed information on one or more containers.
    docker logs             # Fetch the logs of a container.
```

### Volume
A volume in Docker is a persistent data storage mechanism that allows data to be shared between containers or between a container and the host system. 
Volumes are used to persist data generated by containers, ensuring that data is preserved even if the container is stopped or deleted. 
They provide a way to manage data separate from container lifecycle, making it easier to manage stateful applications.

```Makefile
creation:
    docker volume create    # Create a new volume.

deletion:
    docker volume rm        # Remove one or more volumes.
    docker volume prune     # Remove all unused volumes.

information:
    docker volume ls        # List volumes.
    docker volume inspect   # Display detailed information on one or more volumes.
```

### Network
A network in Docker is a communication channel that allows containers to communicate with each other and with external networks. 
Docker networks provide isolation and segmentation, allowing containers to be grouped together based on their communication needs. 
They enable services running in containers to communicate securely and efficiently, facilitating microservices architecture and distributed application deployment. 
Docker provides various network drivers to support different network configurations and requirements.

```Makefile
creation:
    docker network create     # Create a new network.

interaction:
    docker network connect    # Connect a container to a network.
    docker network disconnect # Disconnect a container from a network.

deletion:
    docker network rm         # Remove one or more networks.

information:
    docker network ls         # List networks.
    docker network inspect    # Display detailed information on one or more networks.
```

## Dockerfile
A Dockerfile is a text document that contains instructions for building a Docker image. These instructions define the environment inside the container, including the base image, dependencies, environment variables, and commands to run when the container starts. Dockerfiles provide a reproducible and automated way to create consistent Docker images, making it easy to share and deploy applications across different environments.

```Dockerfile
# Base Image
FROM ubuntu:latest                         # Set the base image for subsequent instructions

# External Configuration
ONBUILD ADD . /app                         # Add a trigger instruction to be executed when the image is used as the base for another build
LABEL author="Othello"                     # Specifies the maintainer of the Dockerfile
USER user:group                            # Set the user or UID for the container
SHELL ["/bin/bash", "-c"]                  # Configure the shell used for executing commands

# File System Operations
VOLUME ["/data"]                           # Creates a mount point and marks it as externally mounted
COPY . /app                                # Copies files or directories from the build context to the image
ADD http://example.com/file.txt /file.txt  # Copies files or directories from the build context to the image and allows URLs and TAR extraction

# Internal Configuration
ENV APP_ENV=production                     # Sets an environment variable in the image
ARG VERSION=latest                         # Defines a build-time variable with an optional default value
RUN apt-get update && \                    # Executes a command in the image
    apt-get install -y curl
WORKDIR /app                               # Sets the working directory for subsequent instructions

# Networking
EXPOSE 8080                                # Exposes a port at runtime for networking

# Health Check
HEALTHCHECK --interval=30s --timeout=3s \  # Defines a health check command
    CMD /path/to/health_check_script.sh

# Execution and Entrypoint
ENTRYPOINT ["node", "app.js"]              # Configures the container to run as an executable
CMD ["--config", "config.json"]            # Specifies the default command to run when the container starts
```

## Docker Compose
Docker Compose is a tool for defining and running multi-container Docker applications. It uses a YAML file to define the services, networks, and volumes required for an application and allows you to start, stop, and manage the entire application stack with a single command. Docker Compose simplifies the orchestration of complex applications by providing a declarative syntax for defining the application configuration and automating common tasks like container linking and network setup.

### Commands
```Makefile
start:
    docker-compose up       # Build, create, start, and attach to containers for a service.
    docker-compose build    # Build or rebuild services defined in the `docker-compose.yml` file.
    docker-compose create   # Create services defined in the `docker-compose.yml` file.
    docker-compose start    # Start services.

stop:
    docker-compose down     # Stop and remove containers, networks, volumes, and images created by `docker-compose up`.
    docker-compose rm       # Remove stopped containers.
    docker-compose stop     # Stop services.
    docker-compose kill     # Forcefully stop services.
    docker-compose restart  # Restart services.

interact:
    docker-compose run      # Run a one-off command in a service container.
    docker-compose exec     # Run a command in a running service container.
    docker-compose pause    # Pause services.
    docker-compose unpause  # Unpause services.

inspect:
    docker-compose images   # List images used by services.
    docker-compose ps       # List running services.
    docker-compose top      # Display the running processes of a service.
    docker-compose logs     # View output from services.

manage:
    docker-compose pull     # Pull images for services from the Docker Hub.
    docker-compose push     # Push images for services to the Docker Hub.
    docker-compose config   # Validate and view the Docker Compose file.
    docker-compose scale    # Set the number of containers for a service.
    docker-compose events   # Receive real-time events from containers.
    docker-compose port     # Print the public port for a service's container.
    docker-compose version  # Show the Docker-Compose version information.
```

### docker-compose.yml
The version section specifies the version of the Docker Compose file format being used. 
It determines which features and syntax are available for defining services, networks, volumes, and other configurations in the Docker Compose file.
```yml
version: '3.8'
```

The services section defines the containers that make up the application. 
Each service represents a containerized component of the application, such as a web server, database, or worker process. 
Services can be configured with various options, including the Docker image to use, ports to expose, volumes to mount, dependencies, and more.
```yml
services:
  web:
    # Crucial Configuration Options
    image: nginx:latest  # Specifies the Docker image to use for the service.
    container_name: web_container  # Sets the name of the container.
    ports:  # Exposes ports from the container to the host system.
      - "8080:80"  # Maps port 80 inside the container to port 8080 on the host.

    # Important Configuration Options
    volumes:  # Specifies volumes to mount into the container.
      - ./nginx.conf:/etc/nginx/nginx.conf  # Mounts the local nginx.conf file into the container.
    networks:  # Defines which networks the service should be connected to.
      - frontend  # Connects to the frontend network.
      - backend   # Connects to the backend network.
    depends_on:  # Specifies dependencies between services.
      - db  # Indicates that the service depends on the db service.
  
    # Optional Configuration Options
    build:  # Specifies the build context for building a custom Docker image.
      context: ./path/to/build/context  # Specifies the build context directory.
      dockerfile: Dockerfile  # Specifies the Dockerfile to use for building the image.
    environment:  # Specifies environment variables directly.
      - POSTGRES_DB=mydatabase  # Sets the name of the database to "mydatabase".
      - POSTGRES_USER=myuser     # Sets the username for accessing the database.
      - POSTGRES_PASSWORD=mypassword  # Sets the password for accessing the database.
    env_file:  # Specifies an external file containing environment variables.
      - ./db.env  # Specifies the file containing the environment variables.
    entrypoint:  # Overrides the default entrypoint specified by the Docker image.
      - "/bin/bash"  # Specifies the entrypoint command.
    command:  # Overrides the default command specified by the Docker image.
      - "--option"  # Specifies the command to execute.
    extra_hosts:  # Adds additional hostnames to resolve inside the container.
      - "host1:192.168.0.1"  # Maps hostname "host1" to IP address "192.168.0.1".
    labels:  # Adds metadata to the container.
      - com.example.description="Database container"  # Adds a description label.
      - com.example.department="IT"  # Adds a department label.
    restart:  # Defines the restart policy for the service.
      unless-stopped  # Restarts the container unless explicitly stopped.
    secrets:  # Specifies secrets to be passed to the service.
      - db_password  # Specifies the name of the secret.
    user:  # Sets the user or UID for the container.
      1000:1000  # Specifies the user and group IDs.
    working_dir:  # Sets the working directory for the command.
      /app  # Specifies the working directory path.
    privileged:  # Gives the container full access to the host system.
      true  # Enables privileged mode.
    cap_add:  # Adds Linux capabilities.
      - SYS_ADMIN  # Adds the SYS_ADMIN capability.
    cap_drop:  # Drops Linux capabilities.
      - NET_ADMIN  # Drops the NET_ADMIN capability.
    devices:  # Allows the container to access host devices.
      - "/dev/sda:/dev/xvda:rwm"  # Maps the host device to the container device.
    dns:  # Sets custom DNS servers for the container.
      - 8.8.8.8  # Sets Google's DNS server.
      - 8.8.4.4  # Sets Google's backup DNS server.
    healthcheck:  # Defines a health check for the service.
      test: ["CMD", "curl", "-f", "http://localhost/"]  # Specifies the command to check the health.
      interval: 1m  # Sets the interval between health checks.
      timeout: 10s   # Sets the timeout for health checks.
      retries: 3     # Sets the number of retries before considering the container unhealthy.
      start_period: 40s  # Sets the start period for health checks.
    logging:  # Specifies logging options for the container.
      driver: syslog  # Sets the logging driver to syslog.
      options:  # Specifies additional logging options.
        syslog-address: "tcp://192.168.1.10:123"
    stop_signal:  # Specifies the signal to stop the container.
      SIGTERM  # Sets the stop signal to SIGTERM.
```

The networks section defines custom networks for the services. 
Networks facilitate communication between containers in a Docker Compose environment. 
Services can be connected to one or more networks, allowing them to communicate with each other securely.
```yml
networks:
  frontend:
    # Crucial Configuration Options
    driver: bridge  # Specifies the driver type for the network.
    
    # Important Configuration Options
    ipam:  # IP Address Management configuration for the network.
      driver: default  # Specifies the IPAM driver.
      config:  # Specifies IP address configuration for the network.
        - subnet: "192.168.0.0/24"  # Specifies the subnet for the network.
        - gateway: "192.168.0.1"  # Specifies the gateway for the network.
    attachable: true  # Enables attachable mode for the network, allowing other services to attach to it.
    
    # Optional Configuration Options
    enable_ipv6: true  # Enables IPv6 support for the network.
    internal: false  # Specifies whether the network should be internal-only.
    labels:  # Adds metadata labels to the network.
      - com.example.description="Frontend network"  # Adds a description label.
      - com.example.department="IT"  # Adds a department label.
    external: true  # Specifies whether the network is external.
    name: custom_frontend_network  # Specifies a custom name for the network.
    driver_opts:  # Specifies additional options for the network driver.
      com.docker.network.bridge.name: "custom_bridge"  # Sets the name of the network bridge.
      com.docker.network.bridge.enable_ip_masquerade: "true"  # Enables IP masquerading.
      com.docker.network.bridge.host_binding_ipv4: "0.0.0.0"    # Specifies the IPv4 address to bind to.
      com.docker.network.bridge.enable_ip6: "true"   # Enables IPv6 for the network.
      com.docker.network.driver.mtu: "1500"          # Sets the maximum transmission unit (MTU) for the network.
```

The volumes section defines named volumes for persisting data used by services. 
Volumes provide a way to store and share data between containers, ensuring data persistence and facilitating data management in a Docker environment.
```yml
volumes:
  data_volume:
    # Crucial Configuration Options
    driver: local  # Specifies the driver type for the volume.
    
    # Important Configuration Options
    driver_opts:  # Options specific to the volume driver.
      type: "nfs"  # Specifies the type of volume to create.
      o: "addr=192.168.1.10,rw,nolock"  # Specifies additional options for the volume.
    
    # Optional Configuration Options
    external: true  # Specifies whether the volume is external.
    name: custom_data_volume  # Specifies a custom name for the volume.
    labels:  # Adds metadata labels to the volume.
      - com.example.description="Data volume"  # Adds a description label.
      - com.example.department="IT"  # Adds a department label.
    driver_opts:  # Specifies additional options for the volume driver.
      type: "local"  # Specifies the type of volume to create.
      device: "/dev/xvdf"  # Specifies the device to use for the volume.
      o: "bind"  # Specifies additional options for the volume.
```

The secrets section defines sensitive data that should be securely passed to services. 
Secrets allow you to manage and distribute sensitive information, such as passwords or API keys, without exposing them in plain text in the Docker Compose file.
```yml
secrets:
  db_password:
    # Crucial Configuration Options
    file: ./db_password.txt  # Specifies the file containing the secret data.
    
    # Important Configuration Options
    external: true  # Specifies whether the secret is external and managed outside of Docker Compose.
    
    # Optional Configuration Options
    name: custom_db_password_secret  # Specifies a custom name for the secret.
    labels:  # Adds metadata labels to the secret.
      - com.example.description="Database password"  # Adds a description label.
      - com.example.department="IT"  # Adds a department label.
```

The configs section defines configuration files or data to be shared among services. 
Configs allow you to manage configuration data separately from the Docker Compose file, making it easier to update and maintain configuration settings for your services.
```yml
configs:
  nginx_config:
    # Crucial Configuration Options
    file: ./nginx.conf  # Specifies the file containing the configuration data.
    
    # Important Configuration Options
    external: true  # Specifies whether the config is external and managed outside of Docker Compose.
    
    # Optional Configuration Options
    name: custom_nginx_config  # Specifies a custom name for the config.
    labels:  # Adds metadata labels to the config.
      - com.example.description="Nginx configuration"  # Adds a description label.
      - com.example.department="IT"  # Adds a department label.
```

## Mariadb
MariaDB is an open-source relational database management system (RDBMS) that originated as a fork of MySQL. It was created by the original developers of MySQL after concerns arose over the acquisition of MySQL by Oracle Corporation. MariaDB shares a similar architecture and design with MySQL but offers additional features, performance improvements, and a commitment to open-source principles. It is known for its compatibility with MySQL, making it a drop-in replacement for many MySQL applications. MariaDB is widely used for building and managing databases in various applications and industries.
### Users
```mysql
-- Show existing users
SELECT User, Host, Password FROM mysql.user;
-- Create new user with set password
CREATE USER IF NOT EXISTS 'username'@'localhost' IDENTIFIED BY 'password';
-- Alter user settings
ALTER USER 'username'@'host'
    IDENTIFIED BY 'new_password'    -- Changes the password for the user.
    IDENTIFIED WITH authentication_plugin    -- Changes the authentication plugin for the user.
    IDENTIFIED WITH authentication_plugin AS 'authentication_string'    -- Changes the authentication plugin and authentication string for the user.
    REQUIRE NONE    -- Removes the requirement for SSL/TLS for the user.
    REQUIRE SSL    -- Requires SSL/TLS for the user.
    REQUIRE X509    -- Requires SSL/TLS with X.509 certificate authentication for the user.
    REQUIRE ISSUER 'issuer'    -- Requires SSL/TLS with X.509 certificate authentication and a specific issuer for the user.
    REQUIRE SUBJECT 'subject'    -- Requires SSL/TLS with X.509 certificate authentication and a specific subject for the user.
    REQUIRE CIPHER 'cipher'    -- Requires SSL/TLS with a specific cipher for the user.
    REQUIRE ISSUER '/C=country/ST=state/L=location/O=organisation/OU=department/CN=commonname/emailAddress=email@address.com'    -- Example of specifying issuer for SSL/TLS.
    ACCOUNT LOCK    -- Locks the user account, preventing login.
    ACCOUNT UNLOCK    -- Unlocks a previously locked user account.
    PASSWORD EXPIRE    -- Sets the password of the user to expire.
    PASSWORD EXPIRE INTERVAL N DAY    -- Sets the password of the user to expire after N days.
    PASSWORD EXPIRE NEVER    -- Sets the password of the user to never expire.
    MAX_QUERIES_PER_HOUR count    -- Sets the maximum number of queries the user can execute per hour.
    MAX_UPDATES_PER_HOUR count    -- Sets the maximum number of updates (inserts, deletes, updates) the user can execute per hour.
    MAX_CONNECTIONS_PER_HOUR count    -- Sets the maximum number of connections the user can make per hour.
    MAX_USER_CONNECTIONS count    -- Sets the maximum number of simultaneous connections the user can have.
    RESOURCE GROUP group_name;    -- Assigns the user to a specific resource group.

-- Adjust privileges
GRANT ALL ON *.* TO 'username'@'%';
FLUSH PRIVILEGES;
-- Delete User
DROP USER 'name'@'localhost';
```
### Databases
```mysql
-- Show existing databases
SHOW DATABASES;
-- Create new database;
CREATE DATABASE IF NOT EXISTS name;
-- Switch to database
USE name;
-- Alter database
ALTER DATABASE name
    CHARACTER SET setname    -- Changes the character set of the database and its default collation.
    COLLATE collationname    -- Changes the default collation for the database.
    DEFAULT CHARACTER SET setname    -- Sets the default character set for the database.
    DEFAULT COLLATE collationname    -- Sets the default collation for the database.
    DEFAULT ENCRYPTION [=] { 'Y' | 'N' }    -- Sets the default encryption for new tables in the database.
    DEFAULT STORAGE ENGINE storage_engine_name    -- Sets the default storage engine for the database.
    RENAME TO new_database_name    -- Renames the database.
    UPGRADE DATA DIRECTORY NAME    -- Upgrades the data directory name for the database.
    DEFAULT TABLE ENCRYPTION [=] { 'Y' | 'N' }    -- Sets the default table encryption for the database.
    UPGRADE    -- Upgrades the database to a new version.
    CONNECTION LIMIT max_connections    -- Sets the maximum number of simultaneous client connections allowed to the database.
    MAX_CONNECTIONS_PER_HOUR max_connections    -- Sets the maximum number of connections allowed per hour from a single host to the database.
    MAX_QUERIES_PER_HOUR max_queries    -- Sets the maximum number of queries allowed per hour from a single host to the database.
    MAX_UPDATES_PER_HOUR max_updates    -- Sets the maximum number of updates (inserts, deletes, updates) allowed per hour from a single host to the database.
    MAX_USER_CONNECTIONS max_connections;    -- Sets the maximum number of simultaneous connections allowed for any user account to the database.
-- Delete database
DROP DATABASE name;
```
### Tables
```mysql
-- Show existing tables in a database
SHOW TABLES;
-- Show table structure
DESCRIBE name;
SHOW COLUMNS FROM name;
-- Show table contents
SELECT * FROM name;
-- Create a new table (requires at least 1 column)
CREATE TABLE IF NOT EXISTS name    --colname datatype constraint
(
    id INT PRIMARY KEY,    -- number, used as primary key
    name VARCHAR(23) NOT NULL, -- character string, cannot be empty
    uniquename VARCHAR(42) UNIQUE    -- character string, must be unique
);
-- Rename table
RENAME TABLE oldname TO newname;
-- Alter table
ALTER TABLE name
    ADD colname datatype constraints    -- Add a new column to the table
    MODIFY colname datatype constraints    -- Modify a column in the table
    CHANGE oldcolname newcolname datatype constraints    -- Modify column name
    DROP COLUMN colname;    -- Remove column from table
-- Inject information row
INSERT INTO name (id, uniquename, name)
VALUES    (1, 'ipsum', 'Lorem'),
    (2, 'dolor', 'Lorem'),
    (3, 'sit', 'Lorem');
-- Remove information row
DELETE FROM name WHERE condition;    -- condition example: id = 2
-- Truncate table (clear rows)
TRUNCATE TABLE name;
-- Remove table
DROP TABLE name;
```
